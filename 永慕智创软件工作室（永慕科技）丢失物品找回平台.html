<!DOCTYPE html> 
<html lang="zh-CN"> 
<head> 
 <meta charset="UTF-8"> 
 <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
 <title>失物找回平台 - 永慕智创软件工作室（永慕科技）</title> 
 <style> 
 * { 
  margin: 0; 
  padding: 0; 
  box-sizing: border-box; 
  font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif; 
 } 
 
 body { 
  background-color: #f5f5f5; 
  color: #333; 
  line-height: 1.6; 
  padding: 20px; 
  max-width: 800px; 
  margin: 0 auto; 
 } 
 
 .container { 
  background-color: #fff; 
  border-radius: 10px; 
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); 
  padding: 30px; 
  margin-top: 20px; 
 } 
 
 h1 { 
  color: #1a73e8; 
  text-align: center; 
  margin-bottom: 30px; 
  font-size: 24px; 
 } 
 
 .notice { 
  background-color: #fff8e1; 
  border-left: 4px solid #ffc107; 
  padding: 15px; 
  margin-bottom: 20px; 
  font-size: 14px; 
 } 
 
 .contact-info { 
  margin-bottom: 30px; 
 } 
 
 .contact-item { 
  display: flex; 
  align-items: center; 
  margin-bottom: 15px; 
 } 
 
 .contact-icon { 
  width: 40px; 
  height: 40px; 
  background-color: #1a73e8; 
  border-radius: 50%; 
  display: flex; 
  align-items: center; 
  justify-content: center; 
  color: white; 
  margin-right: 15px; 
  font-size: 20px; 
 } 
 
 .contact-detail { 
  flex: 1; 
 } 
 
 .contact-detail h3 { 
  color: #1a73e8; 
  margin-bottom: 5px; 
  font-size: 16px; 
 } 
 
 .contact-detail p { 
  color: #666; 
  font-size: 14px; 
 } 
 
 .warning { 
  background-color: #ffebee; 
  border-left: 4px solid #f44336; 
  padding: 15px; 
  margin-bottom: 20px; 
  font-size: 14px; 
 } 
 
 .footer { 
  text-align: center; 
  margin-top: 30px; 
  font-size: 12px; 
  color: #999; 
 } 
 
 .ip-display { 
  margin-top: 20px; 
  padding: 15px; 
  background-color: #e8f5e9; 
  border-left: 4px solid #4caf50; 
  font-size: 14px; 
 } 
 
 @media (max-width: 600px) { 
  .container { 
   padding: 20px; 
  } 
 
  h1 { 
   font-size: 20px; 
  } 
 } 
 </style> 
</head> 
<body> 
 <div class="container"> 
  <h1>永慕智创软件工作室（永慕科技）失物找回平台</h1> 
 
  <div class="notice"> 
   您进入此网页说明您拾取到并扫描带有由永慕智创软件工作室（永慕科技）提供失物找回服务的二维码。<br> 
   该平台提供了失主的联系方式，方便您联系，也为更好确定您的位置进而方便失主主动联系您，需获取您的IP地址、位置信息，请悉知！<br>
   ⚠️IP地址获取后将会自动弹窗申请获取位置信息，麻烦手动点击允许！
   【请提前打开手机定位服务开关，根据中华人民共和国相关法律规定：您的个人隐私数据将在失物找回后永久删除，不做任何备份。】 
  </div> 
 
  <div class="contact-info"> 
   <h2>失主联系方式</h2> 
   <div class="contact-item"> 
    <div class="contact-icon">📱</div> 
    <div class="contact-detail"> 
     <h3>联系电话</h3> 
     <p>18788430982</p> 
    </div> 
   </div> 
   <div class="contact-item"> 
    <div class="contact-icon">✉️</div> 
    <div class="contact-detail"> 
     <h3>电子邮箱</h3> 
     <p>liliuhang1124@outlook.com</p> 
    </div> 
   </div> 
   <div class="contact-item"> 
    <div class="contact-icon">💬</div> 
    <div class="contact-detail"> 
     <h3>代理负责微信</h3> 
     <p>ymkj_weixin</p> 
    </div> 
   </div> 
  </div> 
 
  <div class="warning"> 
   <h3>重要警示</h3> 
   <p>您的IP为：<span id="user-ip">正在获取...</span></p> 
   <p>IP信息、地址信息将被记录上传到管理后台，请及时联系失主归还物品。</p> 
   <p>【如您在扫码识别进入此平台后未及时联系失主，失主可根据相关信息至所在地公安机关报警，由此带来的后果由您承担】</p> 
   <p>根据中华人民共和国相关法律规定：您的个人隐私数据将在失物找回后永久删除，不做任何备份。</p> 
  </div> 
 
  <div class="ip-display" id="location-info" style="display: none;"> 
   <h3>位置信息</h3> 
   <p>您的位置信息：<span id="user-location">正在获取位置...</span></p> 
   <p>详细地址：<span id="user-address">正在获取详细地址...</span></p>
   <p>我们已记录此信息并通知失主，烦请您优先通过以上联系方式联系失主。</p> 
  </div> 
 
  <div class="footer"> 
   建设运营：永慕智创软件工作室（永慕科技）<div>技术支持：高德地图、阿里云
  </div> 
 </div> 

<div id="container"></div> 
<script type="text/javascript"> 
 window._AMapSecurityConfig = { 
  securityJsCode: "6655b8ddcef38eb7dcfc6b4ec649cedd", 
 };//如您非永慕智创软件工作室（永慕科技）员工，严禁滥用securityJsCode，否则将负法律责任！ 
</script> 
<script 
 type="text/javascript" 
 src="https://webapi.amap.com/maps?v=2.0&key=197ddb697c7ee953ddd1e0472d95b201" 
></script> 
<script type="text/javascript"> 
 var map = new AMap.Map("container", { 
  zoom: 12, 
 }); 
</script> 
 <script> 
 // 显示初始弹窗提示 
 alert("您进入此网页说明您拾取到并扫描带有由永慕智创软件工作室（永慕科技）提供失物找回服务的二维码。\n为更好确定您的位置进而方便失主联系您，需获取您的IP地址、位置信息，请提前打开手机定位服务开关！\n⚠️IP地址获取后将会自动弹窗申请获取位置信息，麻烦手动点击允许！\n\n【根据中华人民共和国相关法律规定：您的个人隐私数据将在失物找回后永久删除，不做任何备份。】"); 
 
 // 第一次确认定位服务 
 if (!confirm("【第一次提醒】请确定已打开手机定位服务，确保正确获取所需信息。\n确认打开手机定位服务后再点击确定。")) { 
  alert("请先开启定位服务后再刷新页面重试！"); 
  throw new Error("定位服务未开启"); 
 } 
 
 // 第二次确认定位服务 
 if (!confirm("【第二次提醒】请再次确认：请确保已打开手机定位服务。\n点击确定继续获取位置信息。\n⚠️IP地址获取后将会自动弹窗申请获取位置信息，麻烦手动点击允许！")) { 
  alert("请先开启定位服务后再刷新页面重试！"); 
  throw new Error("定位服务未确认开启"); 
 } 
 
 // 获取IP地址（使用第三方API） 
 function getIPAddress(callback) { 
  fetch('https://api.ipify.org?format=json') 
   .then(response => response.json()) 
   .then(data => callback(data.ip)) 
   .catch(error => { 
    console.error('获取IP地址失败:', error); 
    // 备用IP获取API 
    fetch('https://ipapi.co/json/') 
     .then(response => response.json()) 
     .then(data => callback(data.ip)) 
     .catch(error => { 
      console.error('备用IP获取失败:', error); 
      callback('无法获取IP地址'); 
     }); 
   }); 
 } 
 
 // 使用高德地图API获取位置信息和详细地址
 function getAMapLocationAndAddress(callback) { 
  return new Promise((resolve, reject) => { 
   // 设置5秒超时
   const timeout = setTimeout(() => { 
    reject(new Error('获取位置信息超时')); 
   }, 5000); 
   
   AMap.plugin('AMap.Geolocation', function() { 
    const geolocation = new AMap.Geolocation({ 
     enableHighAccuracy: true, 
     timeout: 10000, 
     position: 'RB' 
    }); 
    
    geolocation.getCurrentPosition(function(status, result) { 
     clearTimeout(timeout); 
     
     if (status === 'complete') { 
      const { position } = result; 
      const locationStr = `纬度: ${position.lat}, 经度: ${position.lng}`; 
      
      // 使用高德地图反向地理编码API获取详细地址
      AMap.plugin('AMap.Geocoder', function() {
       const geocoder = new AMap.Geocoder({
        radius: 1000, // 设置查询范围，单位米
        extensions: "all" // 返回地址描述和行政区划信息
       });
       
       geocoder.getAddress(position, function(status, result) {
        if (status === 'complete' && result.regeocode) {
         const address = result.regeocode.formattedAddress;
         callback(locationStr, address);
         resolve({ location: locationStr, address: address });
        } else {
         console.error('获取详细地址失败:', result.message);
         callback(locationStr, '无法获取详细地址');
         reject(new Error(result.message));
        }
       });
      });
     } else { 
      console.error('高德地图获取位置失败:', result.message); 
      callback('无法获取精确位置信息', '无法获取详细地址'); 
      reject(new Error(result.message)); 
     } 
    }); 
   }); 
  }); 
 } 
 
 // 发送邮件到指定邮箱（通过后端API）
 function sendEmail(ip, location, address) {
  const recipient = 'liliuhang1124@outlook.com'; 
  const emailData = {
    ip: ip,
    location: location,
    address: address,
    recipient: recipient
  };

  // 发送请求到后端API
  fetch('https://yongmukeji.top/send-email?IP&location=&address&recipient', { // 替换为你的后端API URL
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(emailData)
  })
  .then(response => response.json())
  .then(data => console.log('邮件发送结果:', data))
  .catch(error => console.error('邮件发送失败:', error));
 } 
 
 // 页面加载时执行
 document.addEventListener('DOMContentLoaded', function() { 
  // 获取IP地址
  getIPAddress(ip => { 
   document.getElementById('user-ip').textContent = ip; 
   
   // 0秒后获取位置信息和详细地址
   setTimeout(() => { 
    getAMapLocationAndAddress((location, address) => { 
     document.getElementById('user-location').textContent = location; 
     document.getElementById('user-address').textContent = address; 
     document.getElementById('location-info').style.display = 'block'; 
     
     // 发送邮件
     sendEmail(ip, location, address); 
    }).catch(error => { 
     console.error('获取位置信息或详细地址失败:', error); 
     document.getElementById('user-location').textContent = '获取位置信息失败'; 
     document.getElementById('user-address').textContent = '获取详细地址失败'; 
     document.getElementById('location-info').style.display = 'block'; 
     
     // 即使位置或详细地址获取失败也发送通知邮件（仅IP）
     sendEmail(ip, '无法获取位置信息', '无法获取详细地址'); 
    }); 
   }, 0000); 
  }); 
 }); 
 </script> 
</body> 
</html>